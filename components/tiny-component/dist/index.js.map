{"version":3,"file":"index.js","sources":["../../../common/temp/node_modules/without-props/lib/index.js","../../../common/temp/node_modules/catch-decorator/dist/index.js","../src/utils/create-error-class.js","../src/errors/unmount-set-state-error/index.js","../src/index.js"],"sourcesContent":["\"use strict\";\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.default = withoutProps;\r\n\r\n/**\r\n * remove unused props, same as es6 object destructing\r\n *\r\n * @param obj {object} - native object\r\n * @param keys {string[]} - list of object members that will be removed\r\n *\r\n * @example\r\n *  const { className, prefixCls, ...restProps } = withoutProps(this.props, [\r\n *  'isPlaying',\r\n *  'renderPlay',\r\n *  'renderPause',\r\n *  'rotationInPlay',\r\n *  'rotationInPause'\r\n *  ]);\r\n *\r\n * @return {object}\r\n */\r\nfunction withoutProps(obj, keys) {\r\n  var target = {};\r\n\r\n  for (var i in obj) {\r\n    // noinspection JSUnfilteredForInLoop\r\n    if (keys.indexOf(i) >= 0) continue;\r\n    if (!Object.prototype.hasOwnProperty.call(obj, i)) continue;\r\n    target[i] = obj[i];\r\n  }\r\n\r\n  return target;\r\n}\r\n","/**\n * MIT License\n *\n * Copyright (c) 2018 Enkot\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory) :\n    (global['catch-decorator'] = factory());\n}(this, (function () { 'use strict';\n\n    function handleError(ctx, errorClass, handler, error) {\r\n        // check if error is instance of passed error class\r\n        if (typeof handler === 'function' && error instanceof errorClass) {\r\n            // run handler with error object \r\n            // and class context as second argument\r\n            handler.call(null, error, ctx);\r\n        }\r\n        else {\r\n            // throw error further,\r\n            // next decorator in chain can catch it\r\n            throw error;\r\n        }\r\n    }\r\n    // decorator factory function\r\n    var index = (errorClass, handler) => {\r\n        return (target, propertyKey, descriptor) => {\r\n            // save a reference to the original method\r\n            const originalMethod = descriptor.value;\r\n            // rewrite original method with custom wrapper\r\n            descriptor.value = function (...args) {\r\n                try {\r\n                    const result = originalMethod.apply(this, args);\r\n                    // check if method is asynchronous\r\n                    if (result && typeof result.then === 'function' && typeof result.catch === 'function') {\r\n                        // return promise\r\n                        return result.catch((error) => {\r\n                            handleError(this, errorClass, handler, error);\r\n                        });\r\n                    }\r\n                    // return actual result\r\n                    return result;\r\n                }\r\n                catch (error) {\r\n                    handleError(this, errorClass, handler, error);\r\n                }\r\n            };\r\n            return descriptor;\r\n        };\r\n    };\n\n    return index;\n\n})));\n","/**\r\n * 创建错误 class 帮助方法\r\n * @ref https://medium.com/@xpl/javascript-deriving-from-error-properly-8d2f8f315801\r\n * @param {string} errorName - 错误名\r\n * @param {number} errorCode - 错误码\r\n * @param {string} [defaultErrorMessage] - 默认错误信息\r\n * @return {{name, new(...[*]): CustomClass, constructor: *, __proto__, prototype: CustomClass}}\r\n */\r\nexport default function createErrorClass(errorName, errorCode, defaultErrorMessage) {\r\n  return class CustomClass extends window.Error {\r\n    constructor(...args) {\r\n      super(...args);\r\n      if (!this.message) {\r\n        defaultErrorMessage && (this.message = defaultErrorMessage);\r\n      }\r\n      this.constructor = CustomClass;\r\n      // noinspection JSUnusedGlobalSymbols\r\n      this.__proto__ = CustomClass.prototype;\r\n      this.name = errorName;\r\n      this.code = errorCode;\r\n      // Error.captureStackTrace(this, CustomClass);\r\n    }\r\n  };\r\n}\r\n","import createErrorClass from '../../utils/create-error-class';\n\n/**\n * react unmount error\n * @type {{name, new(...[*]): CustomClass, constructor: *, __proto__, prototype: CustomClass}}\n */\nconst UnmountSetStateError = createErrorClass('UnmountSetStateError', undefined , 'component has been mounted. setState is not allowed afterwards');\nexport default UnmountSetStateError;\n","import { Component, PureComponent } from 'react';\nimport _withoutProps from 'without-props';\nimport catchError from 'catch-decorator';\nimport UnmountSetStateError from './errors/unmount-set-state-error';\n\nconst prototype = {\n  // noinspection JSMethodCanBeStatic\n  /**\n   * 移除对象中不相关的属性keys\n   * 以下代码来自官方babel\n   *\n   * @param {object} obj 需要移除的对象\n   * @param {Array<string>} keys 需要移除的属性\n   * @returns {{}} 返回一个移除后的新对象\n   */\n  withoutProps(obj, keys) {\n    return _withoutProps.apply(this, arguments);\n  },\n\n\n  /**\n   * 入队回收队列\n   * @public\n   * @param {Function} disposalAction - 回收操作\n   */\n  enqueueRecycle(disposalAction) {\n    this.$$recycleQueue.push(disposalAction);\n  },\n\n\n  /**\n   * 获取组件命名空间\n   * @param {string} [prefixCls]\n   * @param {string} [componentCssName]\n   * @return {string}\n   */\n  getNs(prefixCls, componentCssName) {\n    if (arguments.length === 2) {\n      return `${prefixCls}-${componentCssName}`;\n    } else {\n      const { prefixCls, componentCssName } = this.props;\n      return `${prefixCls}-${componentCssName}`;\n    }\n  },\n\n\n  /**\n   * 剔除内置属性\n   * @param props\n   * @param extraExcludeProps\n   * @return {{}}\n   */\n  escapeInternalProps(props, extraExcludeProps = []) {\n    return this.withoutProps(props, extraExcludeProps.concat(['prefixCls', 'componentCssName']));\n  },\n\n  /**\n   * 以安全的方式更新 state, 在组件 unmount 后不再进行 setState 操作\n   * @param {object} nextState - 下一个状态\n   * @param {boolean} [throwError] - 是否抛出异常\n   */\n  setSafeState(nextState, throwError = true) {\n    if (!this.$$isUnmount) {\n      this.setState(nextState);\n    } else {\n      throw new UnmountSetStateError();\n    }\n  },\n\n\n  /**\n   * react 生命周期, 使用这个函数进行相关回收, 防止内存泄漏\n   * @public\n   */\n  componentWillUnmount() {\n    this.$$isUnmount = true;\n    this.$$recycleQueue.forEach(recycle => recycle());\n  },\n\n  render() {\n    throw new Error('tiny-component is not intended to be used independently');\n  },\n};\n\nclass TinyComponent extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.$$recycleQueue = [];\n  }\n}\n\nclass TinyPureComponent extends PureComponent {\n  constructor(props, context) {\n    super(props, context);\n    this.$$recycleQueue = [];\n  }\n}\n\n// noinspection JSValidateTypes\nTinyComponent.prototype = prototype;\n// noinspection JSValidateTypes\nTinyPureComponent.prototype = prototype;\n\nexport { TinyComponent, TinyPureComponent, catchError };\n"],"names":["Object","defineProperty","exports","withoutProps","obj","keys","target","i","indexOf","prototype","hasOwnProperty","call","global","factory","module","this","handleError","ctx","errorClass","handler","error","index","propertyKey","descriptor","originalMethod","value","args","result","apply","then","catch","createErrorClass","errorName","errorCode","defaultErrorMessage","message","constructor","CustomClass","__proto__","name","code","window","Error","UnmountSetStateError","undefined","_withoutProps","arguments","disposalAction","$$recycleQueue","push","prefixCls","componentCssName","length","props","extraExcludeProps","concat","nextState","$$isUnmount","setState","forEach","recycle","TinyComponent","context","Component","TinyPureComponent","PureComponent"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;SACpC;CADT;AAGAA,eAAA,GAAkBC,YAAlB;;;;;;;;;;;;;;;;;;;AAmBA,SAASA,YAAT,CAAsBC,GAAtB,EAA2BC,IAA3B,EAAiC;MAC3BC,SAAS,EAAb;;OAEK,IAAIC,CAAT,IAAcH,GAAd,EAAmB;;QAEbC,KAAKG,OAAL,CAAaD,CAAb,KAAmB,CAAvB,EAA0B;QACtB,CAACP,OAAOS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCP,GAArC,EAA0CG,CAA1C,CAAL,EAAmD;WAC5CA,CAAP,IAAYH,IAAIG,CAAJ,CAAZ;;;SAGKD,MAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACVD,WAAUM,MAAV,EAAkBC,OAAlB,EAA2B;IACuCC,cAAA,GAAiBD,SAAhF,AAAA;CADH,EAICE,cAJD,EAIQ,YAAY;;aAERC,WAAT,CAAqBC,GAArB,EAA0BC,UAA1B,EAAsCC,OAAtC,EAA+CC,KAA/C,EAAsD;;YAE9C,OAAOD,OAAP,KAAmB,UAAnB,IAAiCC,iBAAiBF,UAAtD,EAAkE;;;oBAGtDP,IAAR,CAAa,IAAb,EAAmBS,KAAnB,EAA0BH,GAA1B;SAHJ,MAKK;;;kBAGKG,KAAN;;;;QAIJC,QAAQ,CAACH,UAAD,EAAaC,OAAb,KAAyB;eAC1B,CAACb,MAAD,EAASgB,WAAT,EAAsBC,UAAtB,KAAqC;;kBAElCC,iBAAiBD,WAAWE,KAAlC;;uBAEWA,KAAX,GAAmB,UAAU,GAAGC,IAAb,EAAmB;oBAC9B;0BACMC,SAASH,eAAeI,KAAf,CAAqB,IAArB,EAA2BF,IAA3B,CAAf;;wBAEIC,UAAU,OAAOA,OAAOE,IAAd,KAAuB,UAAjC,IAA+C,OAAOF,OAAOG,KAAd,KAAwB,UAA3E,EAAuF;;+BAE5EH,OAAOG,KAAP,CAAcV,KAAD,IAAW;wCACf,IAAZ,EAAkBF,UAAlB,EAA8BC,OAA9B,EAAuCC,KAAvC;yBADG,CAAP;;;2BAKGO,MAAP;iBAVJ,CAYA,OAAOP,KAAP,EAAc;gCACE,IAAZ,EAAkBF,UAAlB,EAA8BC,OAA9B,EAAuCC,KAAvC;;aAdR;mBAiBOG,UAAP;SArBJ;KADJ;;WA0BOF,KAAP;CA9CH,CAAD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxBA;;;;;;;;AAQA,AAAe,SAASU,gBAAT,CAA0BC,SAA1B,EAAqCC,SAArC,EAAgDC,mBAAhD,EAAqE;;;;2BAE3D;;;;;wCAANR,IAAM;YAAA;;;sJACVA,IADU;;UAEf,CAAC,MAAKS,OAAV,EAAmB;gCACO,MAAKA,OAAL,GAAeD,mBAAvC;;YAEGE,WAAL,GAAmBC,WAAnB;;YAEKC,SAAL,GAAiBD,YAAY5B,SAA7B;YACK8B,IAAL,GAAYP,SAAZ;YACKQ,IAAL,GAAYP,SAAZ;;;;;;IAV6BQ,OAAOC,KAAxC;;;ACPF;;;;AAIA,IAAMC,uBAAuBZ,iBAAiB,sBAAjB,EAAyCa,SAAzC,EAAqD,gEAArD,CAA7B;;ACDA,IAAMnC,YAAY;;;;;;;;;;cAAA,wBAUHL,GAVG,EAUEC,IAVF,EAUQ;WACfwC,cAAcjB,KAAd,CAAoB,IAApB,EAA0BkB,SAA1B,CAAP;GAXc;;;;;;;;gBAAA,0BAoBDC,cApBC,EAoBe;SACxBC,cAAL,CAAoBC,IAApB,CAAyBF,cAAzB;GArBc;;;;;;;;;OAAA,iBA+BVG,SA/BU,EA+BCC,gBA/BD,EA+BmB;QAC7BL,UAAUM,MAAV,KAAqB,CAAzB,EAA4B;aAChBF,SAAV,SAAuBC,gBAAvB;KADF,MAEO;mBACmC,KAAKE,KADxC;UACGH,UADH,UACGA,SADH;UACcC,iBADd,UACcA,gBADd;;aAEKD,UAAV,SAAuBC,iBAAvB;;GApCY;;;;;;;;;qBAAA,+BA+CIE,KA/CJ,EA+CmC;QAAxBC,iBAAwB,uEAAJ,EAAI;;WAC1C,KAAKnD,YAAL,CAAkBkD,KAAlB,EAAyBC,kBAAkBC,MAAlB,CAAyB,CAAC,WAAD,EAAc,kBAAd,CAAzB,CAAzB,CAAP;GAhDc;;;;;;;;cAAA,wBAwDHC,SAxDG,EAwD2B;AAAA;QACrC,CAAC,KAAKC,WAAV,EAAuB;WAChBC,QAAL,CAAcF,SAAd;KADF,MAEO;YACC,IAAIb,oBAAJ,EAAN;;GA5DY;;;;;;;sBAAA,kCAqEO;SAChBc,WAAL,GAAmB,IAAnB;SACKT,cAAL,CAAoBW,OAApB,CAA4B;aAAWC,SAAX;KAA5B;GAvEc;QAAA,oBA0EP;UACD,IAAIlB,KAAJ,CAAU,yDAAV,CAAN;;CA3EJ;;IA+EMmB;;;yBACQR,KAAZ,EAAmBS,OAAnB,EAA4B;;;6HACpBT,KADoB,EACbS,OADa;;UAErBd,cAAL,GAAsB,EAAtB;;;;;EAHwBe;;IAOtBC;;;6BACQX,KAAZ,EAAmBS,OAAnB,EAA4B;;;sIACpBT,KADoB,EACbS,OADa;;WAErBd,cAAL,GAAsB,EAAtB;;;;;EAH4BiB;;;;;AAQhCJ,cAAcpD,SAAd,GAA0BA,SAA1B;;AAEAuD,kBAAkBvD,SAAlB,GAA8BA,SAA9B;;;;;;"}